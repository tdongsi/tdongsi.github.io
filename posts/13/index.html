
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Personal Programming Notes</title>
  <meta name="author" content="Cuong Dong-Si">

  
  <meta name="description" content="Basic workflow In summary, the workflow for writing blog in Octopress is as follows: rake new_post["Post title"]
Edit &amp; Preview: rake generate &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tdongsi.github.io/posts/13/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Personal Programming Notes" type="application/atom+xml">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Personal Programming Notes</a></h1>
  
    <h2>To err is human; to debug, divine.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="tdongsi.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/disclaimer">Disclaimer</a></li>
  <li><a href="/resume">Resume</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/11/octopress-cookbook/">Octopress Cookbook</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-11T13:40:13-07:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:40 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Basic workflow</h3>

<p>In summary, the workflow for writing blog in Octopress is as follows:</p>

<ul>
<li><code>rake new_post["Post title"]</code></li>
<li>Edit &amp; Preview:

<ul>
<li><code>rake generate</code>

<ul>
<li>After this step, the published artifacts are generated in the &ldquo;public&rdquo; directory.</li>
</ul>
</li>
<li><code>rake preview</code>

<ul>
<li>Published pages will be served locally at &ldquo;localhost:4000&rdquo;. Preview it in any browser.</li>
<li>Updated Markdown files will be regenerated automatically.</li>
</ul>
</li>
</ul>
</li>
<li>Publish:

<ul>
<li><code>rake generate</code>

<ul>
<li>This step makes sure latest changes are added.</li>
</ul>
</li>
<li><code>rake deploy</code>

<ul>
<li>After this step, the content in the &ldquo;public&rdquo; directory is copied into &ldquo;_deploy&rdquo; directory and git add/commit/push to the remote Github branch.</li>
</ul>
</li>
</ul>
</li>
</ul>


<h3>Setting up new blog</h3>

<p>This section assumes that we will publish in <code>gh-pages</code> branch which is more common (publishing in <code>master</code> branch only works for <code>username.github.io</code> repository).
In general, any project that we work in a repo <code>foo</code> (with main development in branches <code>master</code>/<code>develop</code>) on Github can have associated documentation HTML site in <code>gh-pages</code> branch.
Such documentation site can be accessed publicly at &ldquo;username.github.io/foo/&rdquo;.
Octopress allows easy generation of such static HTML sites.
One can arrange such that each blog post is a tutorial or a documentation page, written in Markdown and &ldquo;compiled&rdquo; into HTML.</p>

<p>The process of setting up such a static &ldquo;documentation&rdquo; site is as follows:</p>

<ol>
<li>Download the zip file from octopress master branch <a href="https://github.com/imathis/octopress">here</a>. Note that <a href="https://github.com/octopress/octopress">this link</a> is version 3, which is different.</li>
<li>Unzip the zip file into the repo. Rename it to &ldquo;docs&rdquo; or &ldquo;octopress&rdquo;.</li>
<li>Commit it to <code>master</code> or <code>develop</code> branch.</li>
<li>Run <code>rake install</code> to generate files. Check in the generated files.</li>
<li>Create <code>_deploy</code> folder for deployment. For new static site, <code>rake setup_github_pages</code> works.</li>
<li>Start blogging/writing documentation. Use the workflow in the last section: <code>rake generate</code> -> <code>rake preview</code> -> <code>rake deploy</code>.</li>
<li>For layout editing, check out one of early commits in <a href="https://github.com/tdongsi/javascript">this repo</a>.</li>
</ol>


<p>NOTE: when previewing the one published in <code>gh-pages</code>, you need to edit &ldquo;destination: public&rdquo; in <code>_config.yml</code> file to &ldquo;destination: public/repo_name&rdquo;.</p>

<h3>Add a new page</h3>

<p>This section is about adding a new page, opposed to a new post.
The common examples of such page in an Octopress-based blog is &ldquo;About&rdquo; page or &ldquo;Resume&rdquo; page.
To create a new page, use the following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake new_page["About"]</span></code></pre></td></tr></table></div></figure>


<p>This will create a new file at &ldquo;source/about/index.markdown&rdquo; and you can edit that file to add content.
After <code>rake generate</code> command, the &ldquo;source/about/index.markdown&rdquo; will &ldquo;compiled&rdquo; into &ldquo;public/about/index.html&rdquo; that is displayed in the web browser.
After the page content is ready, you may want to add an &ldquo;About&rdquo; link in the navigation bar to that page.
To do that, edit the file &ldquo;source/_includes/custom/navigation.html&rdquo;.</p>

<h3>Deployment</h3>

<p>Octopress deploys latest changes with the command <code>rake deploy</code>.
In this <code>deploy</code> step, it copies all the latest changes to the generated static HTML site into a <code>_deploy</code> folder which is a clone of one of the public branches (<code>master</code> or <code>gh-pages</code>) of the same repository.
Create <code>_deploy</code> folder by using this command.</p>

<figure class='code'><figcaption><span>Creating _deploy folder for an on-going blog</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone -b gh-pages git@github.com:user/myproject.git _deploy</span></code></pre></td></tr></table></div></figure>


<p>With Git 1.7.10 and later, add <code>--single-branch</code> to prevent fetching of all branches.</p>

<p>Make sure you use the SSH URL for the Github repo since the HTTPS URL will prompt for password for every deployment.
In addition, SSH public/private key pair must be generated and added to the Github accordingly.
Otherwise, you might get the following errorr:</p>

<figure class='code'><figcaption><span>Common public key error</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## Pushing generated _deploy website
</span><span class='line'>Permission denied (publickey).
</span><span class='line'>fatal: Could not read from remote repository.
</span><span class='line'>
</span><span class='line'>Please make sure you have the correct access rights
</span><span class='line'>and the repository exists.</span></code></pre></td></tr></table></div></figure>


<p>If you get the above message even though the public key is already added to Github, check if you are using the right private key.
Make sure it is added to SSH authentication agent.</p>

<figure class='code'><figcaption><span>Adding SSH identity file</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mymac:octopress tdongsi$ ssh-add ~/.ssh/id_rsa_git
</span><span class='line'>Identity added: /Users/tdongsi/.ssh/id_rsa_git (/Users/tdongsi/.ssh/id_rsa_git)
</span><span class='line'>
</span><span class='line'>mymac:octopress tdongsi$ ssh-add -l -E md5
</span><span class='line'>2048 MD5:ef:c1:d6:4e:92:d2:15:2c:ef:c3:72:d6:c6:98:23:e0 /Users/tdongsi/.ssh/id_rsa_git (RSA)
</span><span class='line'>
</span><span class='line'># Verify your connection
</span><span class='line'>$ ssh -T git@github.com</span></code></pre></td></tr></table></div></figure>


<p>The command <code>ssh-add -l -E md5</code> can be used to find if there is a matching public key on Github.
See <a href="https://help.github.com/articles/error-permission-denied-publickey/">here</a> for more information.</p>

<h3>Reference</h3>

<ul>
<li><a href="http://stackoverflow.com/questions/1911109/how-to-clone-a-specific-git-branch">Clone a specific Git branch</a></li>
<li><a href="http://stackoverflow.com/questions/651038/how-do-you-clone-a-git-repository-into-a-specific-folder">Clone to a specific folder</a></li>
<li><a href="https://help.github.com/articles/error-permission-denied-publickey/">Github instructions on public SSH key</a></li>
</ul>


<p>Recipes:</p>

<ul>
<li><a href="http://blog.zhengdong.me/2012/12/19/latex-math-in-octopress/">Latex for Math formulas</a></li>
<li><a href="http://gangmax.me/blog/2012/05/04/add-about-page-in-octopress/">New page</a></li>
<li><a href="http://octopress.org/docs/plugins/include-code/">Include code from file</a></li>
<li><a href="https://blog.pixelingene.com/2011/09/tips-for-speeding-up-octopress-site-generation/">rake isolate/integrate</a></li>
<li><a href="http://octopress.org/docs/plugins/image-tag/">Image</a></li>
</ul>


<p>Markdown editing tips:</p>

<ul>
<li><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Cheat sheet</a></li>
<li>Use  <code>&lt;!-- more —&gt;</code> to specify Excerpt.</li>
<li>Internal link: <code>(/2012/01/05/hello-world)</code> gives the link &ldquo;<a href="http://userName.github.io/repoName/blog/2012/01/05/hello-world">http://userName.github.io/repoName/blog/2012/01/05/hello-world</a>&rdquo;</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/22/install-ssh-on-windows/">Set Up Public-key SSH on Windows</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-22T11:57:33-07:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>11:57 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Setting up public-key SSH on Windows is much more tricky than Linux (see <a href="/blog/2015/03/02/install-ssh-on-linux/">here</a>).</p>

<h3>Install OpenSSH for Windows</h3>

<p>In the following instructions, the example machine hostname (SSH server) is <code>frak16</code>, with username <code>oqa</code> in the domain <code>OBJY</code>.
Sometimes, another machine (client) is used to connect to this <code>frak16</code> machine to test connection settings.</p>

<p>(1) Install OpenSSH for Windows to the SSH server, e.g., <code>frak16</code>, at the following location <code>SSH_DIR=C:\space\oqa\OpenSSH</code>.
Use OpenSSH installer from <a href="http://www.mls-software.com/opensshd.html">here</a>.
Do NOT use OpenSSH for Windows from Sourceforge, which is outdated, even though many top links from Google search &ldquo;OpenSSH windows&rdquo; point to it.
Select &ldquo;Configure as Domain User&rdquo; when installing.</p>

<p>(2) In the <code>PATH</code> environment variable, make sure that <code>$(SSH_DIR)\bin</code> folder comes before MKS and Cygwin&rsquo;s bins folder, if applicable.
We need to use OpenSSH version of <code>chmod</code> and <code>chown</code>.</p>

<p>(3) Edit the file <code>etc/passwd</code> inside <code>SSH_DIR</code> (defined above).
Make sure that the home directory for your username is present and in <strong>Cygwin notation</strong>, e.g., &ldquo;/cygdrive/c/space/oqa&rdquo; for user <code>oqa</code>.
Make sure there is only one <code>oqa</code> user, like <code>U-OBJY\oqa</code> (domain user) for <code>OBJY</code> domain.
Delete other <code>oqa</code> users such as local users if needed.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oqa:unused_by_nt/2000/xp:13331:10513:oqa,U-OBJY\oqa,S-1-5-21-343818398-1708537768-1417001333-3331:/cygdrive/c/space/oqa:/bin/switch</span></code></pre></td></tr></table></div></figure>


<p>(4) Edit <code>$(SSH_DIR)\etc\banner.txt</code> to include welcome message that you prefer, to make it less verbose and more informative. I would change it to include the current host name to indicate which host is currently connected.</p>

<p>(5a) (Optional but recommended) Run SSH server is debug mode to verify that settings are correct. Run the following command for a test run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\space\cuongd\OpenSSH&gt;usr\sbin\sshd -d -d -d</span></code></pre></td></tr></table></div></figure>


<p>(5b) Use ssh from another host (as client) to test connection. You will have to enter username and password to connect to <code>frak16</code> from this client.</p>

<figure class='code'><figcaption><span>From another machine as client</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh username@hostname -v
</span><span class='line'>
</span><span class='line'>### Example
</span><span class='line'>ssh oqa@frak16 -v</span></code></pre></td></tr></table></div></figure>


<p>If the client is Windows and using OpenSSH, make sure the client&rsquo;s <code>etc/ssh_config</code> file in its OpenSSH installation folder is as follows:</p>

<figure class='code'><figcaption><span>ssh_config</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'># Site-wide defaults for various options
</span><span class='line'>
</span><span class='line'># Host *
</span><span class='line'>#   ForwardAgent no
</span><span class='line'>#   ForwardX11 no
</span><span class='line'>#   RhostsAuthentication no
</span><span class='line'>#   RhostsRSAAuthentication yes
</span><span class='line'>#   RSAAuthentication yes
</span><span class='line'>#   PasswordAuthentication yes
</span><span class='line'>#   FallBackToRsh no
</span><span class='line'>#   UseRsh no
</span><span class='line'>#   BatchMode no
</span><span class='line'>#   CheckHostIP yes
</span><span class='line'>#   StrictHostKeyChecking yes
</span><span class='line'>#   IdentityFile ~/.ssh/identity
</span><span class='line'>#   IdentityFile ~/.ssh/id_dsa
</span><span class='line'>IdentityFile /cygdrive/c/space/cuongd/.ssh/id_rsa    &lt;--- Verify THIS
</span><span class='line'>#   Port 22
</span><span class='line'>#   Protocol 2,1
</span><span class='line'>#   Cipher blowfish
</span><span class='line'>#   EscapeChar ~</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>(6) After making sure the SSH is installed and working properly on <code>frak16</code>, run the following in a Command prompt with Admin power to start SSH as a service:</p>

<figure class='code'><figcaption><span>ssh_config</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>net start opensshd</span></code></pre></td></tr></table></div></figure>


<p>Now, you can connect to this Windows machine <code>frak16</code> using password authentication.</p>

<h3>Set up public-key SSH</h3>

<p>(1) If the client is already set up, it should have its public key file. Copy content of that file to <code>$(HOME_DIR)\.ssh\authorized_keys</code> file on the SSH server (e.g., <code>frak16</code>).</p>

<p>If you don&rsquo;t have the public key file for the client, run <code>ssh-keygen -t rsa</code> on the client machine.
The client machine&rsquo;s public key file has the name like &ldquo;id_rsa.pub&rdquo;.</p>

<p>(2) On the SSH server (e.g., <code>frak16</code>), edit <code>$(SSH_DIR)\etc\sshd_config</code> to enable PubkeyAuthentication. The following lines must be enabled:</p>

<figure class='code'><figcaption><span>sshd_config</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>RSAAuthentication yes
</span><span class='line'>PubkeyAuthentication yes</span></code></pre></td></tr></table></div></figure>


<p>(3) Recursively from <code>$(HOME_DIR)</code>, use <code>chown</code> to set ownership to <code>oqa</code> and <code>chmod</code> to set all folders and files in <code>$(HOME_DIR)\.ssh</code> to read-only.</p>

<figure class='code'><figcaption><span>Set ownership and access</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>### Set the ownership to user oqa
</span><span class='line'>c:\space\oqa&gt;chown -R oqa .
</span><span class='line'>c:\space\oqa&gt;chmod -R 700 .ssh
</span><span class='line'>c:\space\oqa\.ssh&gt;chmod 600 authorized_keys</span></code></pre></td></tr></table></div></figure>


<p>(4) Run SSH server in debug mode again to verify that public-key SSH settings are correct.
Run this command &ldquo;ssh oqa@frak16 &lsquo;ipconfig&rsquo;&rdquo; from the client machine and verify that no password is required.</p>

<p>(5) Start SSH server permanently by running, in an elevated Command Prompt.
As of 2015 Feb, I tried running SSH as a Windows service but it does not work reliably.</p>

<figure class='code'><figcaption><span>Start SSH</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$(SSH_DIR)\usr\sbin\sshd.exe</span></code></pre></td></tr></table></div></figure>


<h3>Troubleshooting</h3>

<p>Some of the most frequently encountered problems are discussed in this section.</p>

<h4>Ownership of <code>.ssh</code> folder</h4>

<p>You might encounter this problem when configuring public-key authentication.
If you try to run the server in debug mode, you might see the following messages:</p>

<figure class='code'><figcaption><span>SSH server output in debug mode (sshd -d -d -d)</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>debug2: input_userauth_request: try method publickey
</span><span class='line'>debug1: test whether pkalg/pkblob are acceptable
</span><span class='line'>debug1: temporarily_use_uid: 13331/10513 (e=13331/10513)
</span><span class='line'>debug1: trying public key file /cygdrive/c/space/oqa/.ssh/authorized_keys
</span><span class='line'>debug3: secure_filename: checking '/cygdrive/c/space/oqa/.ssh'
</span><span class='line'>Authentication refused: bad ownership or modes for directory /cygdrive/c/space/o
</span><span class='line'>qa/.ssh</span></code></pre></td></tr></table></div></figure>


<p>In this case, it&rsquo;s an ownership problem on the SSH server.
You can try another location for <code>.ssh</code> folder on the SSH server to see if it resolves the problem.
In most cases, you can manually fix the above problem by using the following commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>### Set the ownership to user oqa
</span><span class='line'>c:\space\oqa&gt;chown -R oqa .
</span><span class='line'>c:\space\oqa&gt;chmod -R 700 .ssh
</span><span class='line'>c:\space\oqa\.ssh&gt;chmod 600 authorized_keys</span></code></pre></td></tr></table></div></figure>


<p>Note that <code>chmod</code> from OpenSSH must be used, instead of <code>chmod</code> from MKS or Cygwin.
In addition, if there is a Local User <code>oqa</code>, remove that user so that <code>chown</code> will assign ownership to Domain User <code>oqa</code>.</p>

<h4>Outdated SSH installer</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\space\cuongd&gt;scp test.txt oqa@frak16:/cygdrive/c/space/oqa
</span><span class='line'>
</span><span class='line'>Received disconnect from 172.21.62.116: 2: fork failed: Resource temporarily una
</span><span class='line'>vailable
</span><span class='line'>lost connection</span></code></pre></td></tr></table></div></figure>


<p>If you see errors like this, you probably used OpenSSH installer from Sourceforge.
That installer is outdated and buggy.
Use the latest installer from <a href="http://www.mls-software.com/opensshd.html">here</a> instead.</p>

<h4>Cannot bind any address</h4>

<p>You might find the following error message when connecting to an SSH server running in debug mode.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>debug1: rexec_argv[3]='-d'
</span><span class='line'>debug2: fd 3 setting O_NONBLOCK
</span><span class='line'>debug3: sock_set_v6only: set socket 3 IPV6_V6ONLY
</span><span class='line'>debug1: Bind to port 22 on ::.
</span><span class='line'>Bind to port 22 on :: failed: Address already in use.
</span><span class='line'>debug2: fd 3 setting O_NONBLOCK
</span><span class='line'>debug1: Bind to port 22 on 0.0.0.0.
</span><span class='line'>Bind to port 22 on 0.0.0.0 failed: Address already in use.
</span><span class='line'>Cannot bind any address.</span></code></pre></td></tr></table></div></figure>


<p>If you installed Cygwin and/or MKS on your Windows SSH server, their SSH services (sshd for Cygwin and secshd for MKS) are probably using the port 22.
Verify that by using the following command in Windows:</p>

<figure class='code'><figcaption><span>Check service usage</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\space\cuongd\OpenSSH&gt;netstat -b -a
</span><span class='line'>
</span><span class='line'>Active Connections
</span><span class='line'>
</span><span class='line'>  Proto  Local Address          Foreign Address        State
</span><span class='line'>  TCP    0.0.0.0:22             frak15:0               LISTENING
</span><span class='line'>[secshd.exe]
</span><span class='line'>  TCP    0.0.0.0:23             frak15:0               LISTENING
</span><span class='line'>[telnetd.exe]
</span><span class='line'>  TCP    0.0.0.0:135            frak15:0               LISTENING
</span><span class='line'>  RpcSs
</span><span class='line'>[svchost.exe]</span></code></pre></td></tr></table></div></figure>


<p>You can turn off SSH services from Cygwin and MKS by going to Computer > Manage > Go to Services > Stop the relevant service (Windows 7).</p>

<h4>File transfer</h4>

<p>If you installed <code>putty</code> on Windows, note that you CANNOT simply use <code>pscp</code> (that is included with <code>putty</code> installation) to transfer file to another Windows machine with OpenSSH.</p>

<figure class='code'><figcaption><span>PSCP error</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\space\cuongd&gt;pscp -i C:\space\cuongd\.ssh\id_rsa_putty test.txt oqa@frak16:/cygdrive/c/space/oqa
</span><span class='line'>Error: Unable to use key file "C:\space\cuongd\.ssh\id_rsa" (OpenSSH SSH-2 private key)</span></code></pre></td></tr></table></div></figure>


<p>You have to convert the OpenSSH&rsquo;s generated private key to a Putty private key, as detailed <a href="http://www.cnx-software.com/2012/07/20/how-use-putty-with-an-ssh-private-key-generated-by-openssh/">here</a>.</p>

<p>An alternative is to use <code>scp</code> that is included with the OpenSSH installation. Note that this might not work (you still have to enter your password):</p>

<figure class='code'><figcaption><span>This will not work. Password required.</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\space\cuongd&gt;scp -i C:\space\cuongd\.ssh\id_rsa test.txt oqa@frak16:/cygdrive/c/space/oqa</span></code></pre></td></tr></table></div></figure>


<p>Since OpenSSH for Windows is extracted from Cygwin, trying Cygwin-style command turns out to be a good idea. This command allows password-less file transfer:</p>

<figure class='code'><figcaption><span>Password NOT required.</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\space\cuongd&gt;scp -i /cygdrive/c/space/cuongd/.ssh/id_rsa test.txt oqa@frak16:/cygdrive/c/space/oqa</span></code></pre></td></tr></table></div></figure>


<p>Note that files transferred over <code>scp</code> may not be readable (mode 000), regardless of file mode on the sending host.
Therefore, remember to <code>chmod a+r</code> on the receiving host after file transfer, especially in an automation script, or you&rsquo;ll get errors related to file access/file not found.</p>

<h4>Other troubleshooting tips</h4>

<ul>
<li>You may miss adding/setting some environment variables, e.g., <code>PATH</code>. After editing environment variables, you may need to restart your SSHD on a <strong>new</strong> Command Prompt windows to have those new environment variables in effect.</li>
<li>Remember to disable firewall on Windows machines.</li>
</ul>


<h3>Links</h3>

<ol>
<li><a href="http://www.mls-software.com/opensshd.html">Latest OpenSSH installer</a></li>
<li><a href="http://www.cnx-software.com/2012/07/20/how-use-putty-with-an-ssh-private-key-generated-by-openssh/">Use Putty with an SSH private key generated by OpenSSH</a></li>
<li><a href="http://www.worldgoneweb.com/2011/installing-openssh-on-windows-7/">And old tutorial</a>: uses an old OpenSSH installer from Sourceforge. Most of the steps are not needed in the new installers.</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/02/install-ssh-on-linux/">Set Up Public-key SSH on Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-02T10:57:26-08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>10:57 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(1) Log into a Linux system (for CentOS, v5.8 or better) with your user account.</p>

<p>(2) Go to the directory <code>~/.ssh</code>. If such directory is not present, create one and set the permissions to 755.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir ~/.ssh
</span><span class='line'>chmod 755 ~/.ssh
</span><span class='line'>cd ~/.ssh</span></code></pre></td></tr></table></div></figure>


<p>(3) Generate your private and public keys</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[frak10-b13]$ ssh-keygen</span></code></pre></td></tr></table></div></figure>


<p>When you get &ldquo;Enter passphrase (empty for no passphrase):&rdquo;, you can hit enter for a null passphrase for now.
The passphrase can be changed later by using the -p option.
Note that from the <code>man</code> page: &ldquo;USING GOOD, UNGUESSABLE PASSPHRASES IS STRONGLY RECOMMENDED.&rdquo;.
If <code>ssh-keygen</code> returns with &ldquo;You must specify a key type (-t).&rdquo;, then add the flag &ldquo;-t rsa&rdquo;.</p>

<p>(4) The ssh-keygen tool stores the private key in <code>$HOME/.ssh/id_rsa</code> and the public key in <code>$HOME/.ssh/id_rsa.pub</code> in the user’s home directory.
The user should then copy the contents of <code>id_rsa.pub</code> to the <code>$HOME/.ssh/authorized_keys</code> file in his home directory on the <strong>remote</strong> machine.
Verify that you have and authorized_keys file in ~/.ssh. If not create one and set the permissions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat id_rsa.pub &gt;&gt; authorized_keys
</span><span class='line'>chmod 644 ~/.ssh/authorized_keys</span></code></pre></td></tr></table></div></figure>


<p>Verify that you have a known_hosts file <code>~/.ssh/known_hosts</code>.
If not, you can begin to populate this file by doing an ssh session to the system you want to connect to and
answer <code>yes</code> to this question:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>The authenticity of host 'reda64 (172.21.32.38)' can't be established.
</span><span class='line'>RSA key fingerprint is 3f:39:60:a8:b6:c7:37:e6:a6:ff:f5:d2:0b:fc:86:83.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)?</span></code></pre></td></tr></table></div></figure>


<h3>Links</h3>

<ol>
<li><a href="https://en.wikipedia.org/wiki/Ssh-keygen">ssh-keygen</a></li>
</ol>

</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/12">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
    <h1>About Me</h1>
    <p>I write about random things that come to mind, mostly for my future self and any visitor who might find useful.</p>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/05/25/sending-emails-from-docker-containers/">Sending Emails From Docker Containers</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/20/gradle-settings-in-jenkinsfile/">Maven and Gradle Builds in Jenkinsfile</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/15/kubernetes-kube-router/">Kubernetes: Kube-router</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/26/troubleshooting-docker-out-of-docker/">Troubleshooting Docker-out-of-Docker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/26/docker-user-and-group-add-parameters/">Docker: --user and --group-add Parameters</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/tdongsi">@tdongsi</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tdongsi',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/algorithm/'>algorithm (3)</a></li><li><a href='/blog/categories/automation/'>automation (6)</a></li><li><a href='/blog/categories/aws/'>aws (5)</a></li><li><a href='/blog/categories/bash/'>bash (7)</a></li><li><a href='/blog/categories/book/'>book (9)</a></li><li><a href='/blog/categories/cassandra/'>cassandra (1)</a></li><li><a href='/blog/categories/centos/'>centos (2)</a></li><li><a href='/blog/categories/database/'>database (6)</a></li><li><a href='/blog/categories/docker/'>docker (10)</a></li><li><a href='/blog/categories/eclipse/'>eclipse (2)</a></li><li><a href='/blog/categories/git/'>git (5)</a></li><li><a href='/blog/categories/gradle/'>gradle (1)</a></li><li><a href='/blog/categories/groovy/'>groovy (3)</a></li><li><a href='/blog/categories/hadoop/'>hadoop (10)</a></li><li><a href='/blog/categories/hive/'>hive (8)</a></li><li><a href='/blog/categories/java/'>java (10)</a></li><li><a href='/blog/categories/jdbc/'>jdbc (2)</a></li><li><a href='/blog/categories/jenkins/'>jenkins (7)</a></li><li><a href='/blog/categories/jmockit/'>jmockit (3)</a></li><li><a href='/blog/categories/junit/'>junit (2)</a></li><li><a href='/blog/categories/kubernetes/'>kubernetes (6)</a></li><li><a href='/blog/categories/linux/'>linux (1)</a></li><li><a href='/blog/categories/macosx/'>macosx (3)</a></li><li><a href='/blog/categories/math/'>math (1)</a></li><li><a href='/blog/categories/matplotlib/'>matplotlib (2)</a></li><li><a href='/blog/categories/maven/'>maven (4)</a></li><li><a href='/blog/categories/mysql/'>mysql (1)</a></li><li><a href='/blog/categories/numpy/'>numpy (1)</a></li><li><a href='/blog/categories/performance/'>performance (4)</a></li><li><a href='/blog/categories/perl/'>perl (1)</a></li><li><a href='/blog/categories/python/'>python (10)</a></li><li><a href='/blog/categories/ruby/'>ruby (1)</a></li><li><a href='/blog/categories/security/'>security (3)</a></li><li><a href='/blog/categories/sql/'>sql (12)</a></li><li><a href='/blog/categories/testing/'>testing (6)</a></li><li><a href='/blog/categories/testng/'>testng (3)</a></li><li><a href='/blog/categories/vertica/'>vertica (11)</a></li><li><a href='/blog/categories/windows/'>windows (2)</a></li></ul>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Cuong Dong-Si -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
